# 🎲 Monte Carlo Insight Simulator

불확실한 변수들 사이에서 **최선의 의사결정**을 내릴 수 있도록 돕는 확률 기반 분석 도구입니다.  
수만 번의 시뮬레이션을 통해 결과의 **90% 신뢰 구간**과 **변수별 영향도**를 시각적으로 제공합니다.

---

## 🖼️ 주요 화면

| 확률 분포도 | 수렴 그래프 | 민감도 분석 |
|:-----------:|:-----------:|:-----------:|
| P5/P95 신뢰구간 하이라이트 | 평균값 수렴 추이 | 토네이도 차트 |

---

## ✨ 주요 기능

| 기능 | 설명 |
|------|------|
| **다중 변수 설정** | 변수명, 최솟값, 최댓값, 분포(균등/정규/삼각), 가중치 설정 |
| **자동 수렴 감지** | 평균값이 안정화될 때까지 자동으로 시뮬레이션 반복 |
| **90% 신뢰 구간** | P5~P95 범위를 요약 카드와 차트로 표시 |
| **시나리오 관리** | '낙관/중립/비관' 등 변수 세트를 저장하고 불러오기 |
| **인터랙티브 차트** | 확률 분포도 / 수렴 그래프 / 토네이도 차트 |
| **CSV 내보내기** | 시뮬레이션 전체 결과를 CSV로 다운로드 |

---

## 🚀 실행 방법

### 1. 환경 설정 (최초 1회)

```bash
# Python 3.9 이상 필요
py -m pip install -r requirements.txt
```

### 2. 앱 실행

```bash
py -m streamlit run app.py
```

브라우저에서 자동으로 열립니다: **http://localhost:8501**

---

## 📖 사용 방법

### Step 1 — 변수 설정
왼쪽 **사이드바**에서 분석할 변수를 설정합니다.

- **변수명**: 원하는 이름 입력 (예: 판매량, 단가, 원가)
- **최솟값 / 최댓값**: 해당 변수가 가질 수 있는 범위
- **분포 유형**: 세 가지 중 선택 → 아래 **분포 유형 선택 가이드** 참고
- **가중치**: 해당 변수가 최종 결과에 미치는 상대적 비중

➕ **변수 추가** 버튼으로 변수를 여러 개 추가할 수 있습니다.

---

## 📐 분포 유형 선택 가이드 (통계 입문자용)

> 분포(Distribution)는 "이 변수가 어떤 값으로 나타날 가능성이 높은가?"를 표현합니다.  
> 아래 설명을 보고 상황에 맞는 것을 선택하세요.

---

### 🟦 균등분포 (Uniform) — "어느 값이든 똑같이 가능"

최솟값과 최댓값 사이의 **모든 값이 동일한 확률**로 발생합니다.

**언제 쓰나요?**
- 정보가 거의 없어서 "이 범위 안에서 발생한다"는 것만 알 때
- 주사위처럼 특정 값이 더 나오기 쉬운 이유가 없을 때

**실제 예시**
- 배송 소요 시간이 "2일~5일 사이 어딘가"라고만 알 때
- 랜덤 이벤트 발생 시각이 오전 9시~오후 6시 사이일 때

```
확률 ▲
     │████████████████████
     └─────────────────────→ 값
     min                max
```

---

### 🟩 정규분포 (Normal) — "평균값 근처가 가장 흔하다"

**중간값(평균) 근처에서 가장 자주 발생**하고, 양 극단으로 갈수록 드물어지는 종(🔔) 모양입니다.  
자연계와 사회 현상에서 가장 흔하게 나타나는 분포입니다.

**언제 쓰나요?**
- 과거 데이터가 있고 평균값 근처로 결과가 몰리는 경향이 있을 때
- 사람 키, 시험 점수, 측정 오차 같은 현상

**실제 예시**
- 직원 한 명의 월 매출 실적이 보통 500만 원이고 가끔 300만 혹은 700만 원일 때
- 생산 공정에서 제품 무게가 설계치 주변으로 분포할 때

```
확률 ▲
       ██
      ████
     ██████
    ████████
   ██████████
└────────────────→ 값
  min  평균  max
```

---

### 🟧 삼각분포 (Triangular) — "최빈값은 알지만 범위도 존재"

최솟값·최댓값·**최빈값(가장 가능성 높은 값)** 세 가지를 지정하는 분포입니다.  
현재 이 프로그램에서는 최빈값을 `(최솟값 + 최댓값) / 2`로 자동 설정합니다.

**언제 쓰나요?**
- 최악/최선/가장 가능성 높은 결과를 어느 정도 알고 있을 때
- 전문가 판단이나 경험 기반의 추정에 적합
- 데이터가 부족할 때 균등분포보다 현실적인 대안

**실제 예시**
- 프로젝트 완료 기간이 "최소 3개월, 최대 8개월이지만 보통 5개월"일 때
- 신제품 판매량이 "최소 100개, 최대 500개, 가장 가능성 높은 건 250개"일 때

```
확률 ▲
         ▲
        /│\
       / │ \
      /  │  \
     /   │   \
└────────────────→ 값
  min  최빈값 max
```

---

### 🤔 어떤 분포를 골라야 할까?

| 상황 | 추천 분포 |
|------|-----------|
| 범위만 알고 있고 특별한 경향이 없음 | **균등** |
| 과거 데이터가 있고 평균 근처로 몰림 | **정규** |
| 최악/최선/통상적인 값을 경험으로 알고 있음 | **삼각** |
| 처음이라 잘 모르겠음 | **정규** (가장 무난한 기본값) |

---

### Step 2 — 시뮬레이션 설정

- **횟수 지정**: 1,000 ~ 100,000회 중 선택
- **자동 수렴 감지**: 평균값 변화가 허용 오차 이하로 떨어질 때 자동 중단

---

### Step 3 — 시뮬레이션 실행

**🚀 시뮬레이션 실행** 버튼을 클릭하면 결과가 표시됩니다.

---

### Step 4 — 결과 해석

#### 요약 카드

| 카드 | 의미 |
|------|------|
| **P5** | 결과의 하위 5% — 최악에 가까운 시나리오 |
| **P95** | 결과의 상위 5% — 최선에 가까운 시나리오 |
| **평균** | 가장 기대할 수 있는 결과 |
| **표준편차** | 결과의 불확실성 크기 |

#### 탭별 차트

| 탭 | 내용 |
|----|------|
| 📊 **확률 분포도** | 결과값의 분포 히스토그램 + P5/P95 신뢰구간 |
| 📉 **수렴 그래프** | 시뮬레이션 횟수에 따른 평균값 안정화 추이 |
| 🌪️ **민감도 분석** | 어떤 변수가 결과에 가장 큰 영향을 미치는지 순위 |

---

### Step 5 — 시나리오 저장 (선택)

- 현재 변수 설정에 이름을 붙여 **저장**합니다.
- 이후 **불러오기**로 저장된 설정을 즉시 복원합니다.
- 시나리오 파일은 `scenarios/` 폴더에 JSON으로 저장됩니다.

---

## ⚙️ 동작 원리

### 1. 랜덤 샘플링 (Monte Carlo Method)

각 변수에 대해 선택한 분포에 따라 **N개의 난수**를 생성합니다.

```
균등분포: X ~ Uniform(min, max)
정규분포: X ~ Normal(μ=(min+max)/2, σ=(max-min)/6) → clip(min, max)
삼각분포: X ~ Triangular(min, mode=(min+max)/2, max)
```

### 2. 결과 계산 (가중 합산)

각 시뮬레이션 시행에서 모든 변수의 샘플값을 **가중 합산**하여 결과값 하나를 생성합니다.

$$\text{result}_i = \sum_j w_j \cdot x_{ij} \quad \text{(가중치 합이 1이 되도록 정규화)}$$

N번 반복하면 N개의 결과값 집합 $S$가 만들어집니다.

### 3. 90% 신뢰 구간

결과 집합 $S$에서 5번째와 95번째 백분위수를 계산합니다.

$$\text{Range}_{90\%} = [\text{Percentile}(S, 5), \text{Percentile}(S, 95)]$$

### 4. 자동 수렴 감지

이전 배치(1,000회)와 현재 배치의 누적 평균 변화율을 비교합니다.

$$\delta = \frac{|\mu_{\text{cur}} - \mu_{\text{prev}}|}{|\mu_{\text{prev}}| + \epsilon} < \text{tol}$$

수렴 조건 충족 시 시뮬레이션을 자동으로 중단합니다.

### 5. 민감도 분석 (토네이도 차트)

각 입력 변수와 결과값 사이의 **피어슨 상관계수**를 계산합니다.

$$r_{jY} = \frac{\text{Cov}(X_j, Y)}{\sigma_{X_j} \cdot \sigma_Y}$$

$|r|$ 절댓값 내림차순으로 정렬하여 영향력이 큰 변수를 상단에 표시합니다.

---

## 📁 프로젝트 구조

```
Monte-Carlo-simulation/
├── app.py           # Streamlit 메인 UI 앱
├── simulation.py    # 시뮬레이션 엔진 (샘플링, 수렴, 통계)
├── scenarios.py     # 시나리오 저장/불러오기 (JSON)
├── requirements.txt # 의존성 목록
├── scenarios/       # 저장된 시나리오 파일 (자동 생성)
└── PRD.md           # 제품 요구사항 문서
```

---

## 🧰 기술 스택

| 라이브러리 | 역할 |
|------------|------|
| **Python 3.9+** | 언어 |
| **Streamlit** | 웹 UI 프레임워크 |
| **Plotly** | 인터랙티브 차트 |
| **NumPy** | 수치 계산 / 난수 생성 |
| **Pandas** | 데이터 정리 및 통계 |

---

## 📄 라이선스

MIT License
